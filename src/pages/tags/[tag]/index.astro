---
import BaseLayout from '../../../layouts/BaseLayout.astro';

const title = 'Blog';
const description = 'Latest articles.';
const permalink = `${Astro.site.href}blog`;

let allPosts = await Astro.glob('../../data/blog-posts/*.md');
allPosts = allPosts.sort((a, b) => new Date(b.frontmatter.publishDate).valueOf() - new Date(a.frontmatter.publishDate).valueOf());

export async function getStaticPaths({ }) {
  const allPosts = await Astro.glob('../../blog/*.md')
  const allTags = new Set()
  allPosts.map(post => {
      post.frontmatter.tags && post.frontmatter.tags.map(tag => allTags.add(tag.toLowerCase()))
  })
  return Array.from(allTags).map((tag) => {
    const filteredPosts = allPosts.filter((post) => post.frontmatter.tags.includes(tag))
    return {
      params: { tag },
      props: {
          pages: filteredPosts
      }
    };
  });
}
const { pages } = Astro.props
const { tag } = Astro.params
---

<BaseLayout title={title} description={description} permalink={permalink} current="tag">
    <!-- <PostPreviewList posts={pages} /> -->
</BaseLayout>